## 2.객체 생성과 파괴

### 2.생성자에 매개변수가 많다면 빌더를 고려하라
#### 실제로 빌더패턴을 Lombok 에너테이션 @Builder 을 활용해 많이 쓰고 있다. 이번장에서는 이러한 빌더패턴에 대해 알아보자

### 매개변수를 자유롭게 적용 할 수 있는 클래스용 생성자 혹은 정적 팩터리는 크게 3가지가 있다.
1. 점층적 생성자 패턴(telescoping constructor pattern)
2. 자바빈즈 패턴(JavaBeans pattern)
3. 빌더 패턴(Builder pattern)

### 우선 점층적 생성자 패턴을 코드를 통해 살펴보자
```java
public calss NutritionFacts{
    private final int servingSize;  //필수
    private final int servings;     //필수
    private final int calories;     //선택
    private final int fat;          //선택
    private final int sodium;       //선택
    private final int carbohydrate; //선택
    
    public NutritionFacts(int servingSize, int servings){
        this(servingSize, serving, 0);   //필수2 + 선택1 생성자 호출     
    }
        
    public NutritionFacts(int servingSize, int servings, int calories){
        this(servingSize, servings, calories, 0); //필수2 + 선택2 생성자 호출
    }    
    
    public NutritionFacts(int servingSize, int servings, int calories, int fat){
        this(servingSize, servings, calories, fat, 0); //필수2 + 선택3 생성자 호출    
    }
    
    public NutritionFacts(int servingSize, int servings, int calories, int fat, int sodium){
        this(servingSize, servings, calories, fat, sodium, 0); //필수2 + 선택4 생성자 호출   
    }
    
    public NutritionFacts(int servingSize, int servings, int calories, int fat, int sodium, int carbohydrate){
        this.servingSize = servingSize;
        this.servings = servings;
        this.calories = calories;
        this.fat = fat;
        this.sodium = sodium;
        this.carbogydrate = carbohydrate;
    }
}
```
### 클라이언트는 아래와 같이 사용해 인스턴스를 만들어 낼 수 있다.
```java
NutritionFacts cocaCola = new NutritionFacts(240,8,100,0,35,27);
```
### 단점 : 점층적 생성자 패턴은 매개변수가 많아지면 그만큼 클라이언트 코드를 작성하거나 읽기 어렵다.

---

### 이번에는 두번째 대안인 자바빈즈 패턴을 살펴보자 이는 우리가 잘아는 setter 를 활용한 패턴이다.
```java
public class NutritionFacts {
    //매개변수들은 기본값이 있다면 기본값으로 초기화 된다.
    private int servingSize = -1;
    private int servings = -1;
    private int calories = 0;
    private int sodium = 0;
    private int carbohydrate = 0;
    
    public NutritionFacts() {}
    
    public void setServingSize(int val) { servingSize = val; }
    public void setServings(int val) { servings = val; }
    public void setCalories(int val) { calories = val; }
    public void setSodium(int val) { sodium = val; }
    public void setCarbohydrate(int val) { carbohydrate = val; }
    
}
```
### 클라이언트는 아래와 같은 코드로 인스턴스를 생성할 수 있다.
```java
NutritionFacts cocaCola = new NutritionFacts();
cocaCola.setServingSize(240);
cocaCola.setServings(8);
cocaCola.setCalories(100);
cocaCola.setSodium(35);
cocaCola.setCarbohydrate(27);
```
### 단점 : 자바빈즈 패턴은 객체 하나를 만들려면 여러개의 메서드를 호출해야 하고, 
###       객체가 완전히 생성되기까지 여러개의 메서드를 통해 매개변수 값을 채워넣고 있어 일관성이 무너진 코드로 디버깅이 만만치 않다.
###       각각의 setter 를 활용해 클래스 필드 값을 초기화 해주고 있어, 불변성이 깨진코드이고, 불변성이 깨진 코드는 쓰레드 안정성을 깰 수 있는 위험이 있다.

### 다음으로 이팩티브 자바에서 추천하는 빌더 패턴을 살펴보자
```java
public class NutritionFacts {
    private final int servingSize;  //필수
    private final int servings;     //필수
    private final int calories;     //선택
    private final int fat;          //선택
    private final int sodium;       //선택
    private final int carbohydrate; //선택
    
    public static class Builder {
        //필수 매개변수
        private final int servingSize;
        private final int servings;
        
        //선택 매개변수 - 기본값으로 초기화한다.
        private int calories = 0;
        private int fat = 0;
        private int sodium = 0;
        private int carbohydrate = 0;
        
        public Builder(int servingSize, int servings) {
            this.servingSize = servingSize;
            this.servings = servings;
        }
        
        public Builder calories(int val) {
            calories = val;
            return this;
        }
        
        public Builder fat(int val) {
            fat = val;
            return this;
        }
        
        public Builder sodium(int val) {
            sodium = val;
            return this;
        }
        
        public Builder carbohydrate(int val) {
            carbohydrate = val;
            return this;
        }
        
        public NutritionFacts build() {
            return new NutritionFacts(this);
        }
    }
}
```
### 다음은 빌더 패턴으로 인스턴스를 생성하는 클라이언트 코드이다.
```java
NutritionFacts cocaCola = new NutritionFacts.Builder(240,8)
                                .calories(100)
                                .sodium(35)
                                .carbohydrate(27)
                                .build();
```
### 빌더 패턴은 코드의 가독성도 좋고 불변클래스로 안정성을 높일 수 있다.



#### 참고 블로그
###### [Builder Pattern(빌더 패턴 by Effective Java)](https://velog.io/@hero6027/Builder-Pattern%EB%B9%8C%EB%8D%94-%ED%8C%A8%ED%84%B4-by-Effective-Java)
###### [이펙티브 자바 아이템 2. 생성자에 매개변수가 많다면 빌더를 고려하라](https://velog.io/@lychee/%EC%9D%B4%ED%8E%99%ED%8B%B0%EB%B8%8C-%EC%9E%90%EB%B0%94-%EC%95%84%EC%9D%B4%ED%85%9C-2.-%EC%83%9D%EC%84%B1%EC%9E%90%EC%97%90-%EB%A7%A4%EA%B0%9C%EB%B3%80%EC%88%98%EA%B0%80-%EB%A7%8E%EB%8B%A4%EB%A9%B4-%EB%B9%8C%EB%8D%94%EB%A5%BC-%EA%B3%A0%EB%A0%A4%ED%95%98%EB%9D%BC#-%EC%83%9D%EC%84%B1%EC%9E%90%EC%99%80-%EC%A0%95%EC%A0%81-%ED%8C%A9%ED%84%B0%EB%A6%AC-%EB%A9%94%EC%84%9C%EB%93%9C%EC%9D%98-%EC%A0%9C%EC%95%BD)